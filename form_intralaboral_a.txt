CREATE TABLE intralaboral_a_opciones_respuesta (
   id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   etiqueta varchar(30) NOT NULL,
   valor INT NOT NULL
);

INSERT INTO intralaboral_a_opciones_respuesta (etiqueta, valor) VALUES 
   ('Siempre', 1),
   ('Casi siempre', 2),
   ('Algunas veces', 3),
   ('Casi nunca', 4),
   ('Nunca', 5);

CREATE TABLE intralaboral_a_preguntas (
    id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    descripcion VARCHAR(255) NOT NULL
);


INSERT INTO intralaboral_a_preguntas (descripcion) VALUES
('El ruido en el lugar donde trabajo es molesto'),
('En el lugar donde trabajo hace mucho frío'),
('En el lugar donde trabajo hace mucho calor'),
('El aire en el lugar donde trabajo es fresco y agradable'),
('La luz del sitio donde trabajo es agradable'),
('El espacio donde trabajo es cómodo'),
('En mi trabajo me preocupa estar expuesto a sustancias químicas que afecten mi salud'),
('Mi trabajo me exige hacer mucho esfuerzo físico'),
('Los equipos o herramientas con los que trabajo son cómodos'),
('En mi trabajo me preocupa estar expuesto a microbios, animales o plantas que afecten mi salud'),
('Me preocupa accidentarme en mi trabajo'),
('El lugar donde trabajo es limpio y ordenado'),
('Por la cantidad de trabajo que tengo debo quedarme tiempo adicional'),
('Me alcanza el tiempo de trabajo para tener al día mis deberes'),
('Por la cantidad de trabajo que tengo debo trabajar sin parar'),
('Mi trabajo me exige hacer mucho esfuerzo mental'),
('Mi trabajo me exige estar muy concentrado'),
('Mi trabajo me exige memorizar mucha información'),
('En mi trabajo tengo que tomar decisiones difíciles muy rápido'),
('Mi trabajo me exige atender a muchos asuntos al mismo tiempo'),
('Mi trabajo requiere que me fije en pequeños detalles'),
('En mi trabajo respondo por cosas de mucho valor'),
('En mi trabajo respondo por dinero de la empresa'),
('Como parte de mis funciones debo responder por la seguridad de otros'),
('Respondo ante mi jefe por los resultados de toda mi área de trabajo'),
('Mi trabajo me exige cuidar la salud de otras personas'),
('En el trabajo me dan órdenes contradictorias'),
('En mi trabajo me piden hacer cosas innecesarias'),
('En mi trabajo se presentan situaciones en las que debo pasar por alto normas o procedimientos'),
('En mi trabajo tengo que hacer cosas que se podrían hacer de una forma más práctica'),
('Trabajo en horario de noche'),
('En mi trabajo es posible tomar pausas para descansar'),
('Mi trabajo me exige laborar en días de descanso, festivos o fines de semana'),
('En mi trabajo puedo tomar fines de semana o días de descanso al mes'),
('Cuando estoy en casa sigo pensando en el trabajo'),
('Discuto con mi familia o amigos por causa de mi trabajo'),
('Debo atender asuntos de trabajo cuando estoy en casa'),
('Por mi trabajo el tiempo que paso con mi familia y amigos es muy poco'),
('Mi trabajo me permite desarrollar mis habilidades'),
('Mi trabajo me permite aplicar mis conocimientos'),
('Mi trabajo me permite aprender nuevas cosas'),
('Me asignan el trabajo teniendo en cuenta mis capacidades'),
('Puedo tomar pausas cuando las necesito'),
('Puedo decidir cuánto trabajo hago en el día'),
('Puedo decidir la velocidad a la que trabajo'),
('Puedo cambiar el orden de las actividades en mi trabajo'),
('Puedo parar un momento mi trabajo para atender algún asunto personal'),
('Los cambios en mi trabajo han sido beneficiosos'),
('Me explican claramente los cambios que ocurren en mi trabajo'),
('Puedo dar sugerencias sobre los cambios que ocurren en mi trabajo'),
('Cuando se presentan cambios en mi trabajo se tienen en cuenta mis ideas y sugerencias'),
('Los cambios que se presentan en mi trabajo dificultan mi labor'),
('Me informan con claridad cuáles son mis funciones'),
('Me informan cuáles son las decisiones que puedo tomar en mi trabajo'),
('Me explican claramente los resultados que debo lograr en mi trabajo'),
('Me explican claramente el efecto de mi trabajo en la empresa'),
('Me explican claramente los objetivos de mi trabajo'),
('Me informan claramente quien me puede orientar para hacer mi trabajo'),
('Me informan claramente con quien puedo resolver los asuntos de trabajo'),
('La empresa me permite asistir a capacitaciones relacionadas con mi trabajo'),
('Recibo capacitación útil para hacer mi trabajo'),
('Recibo capacitación que me ayuda a hacer mejor mi trabajo'),
('Mi jefe me da instrucciones claras'),
('Mi jefe ayuda a organizar mejor el trabajo'),
('Mi jefe tiene en cuenta mis puntos de vista y opiniones'),
('Mi jefe me anima para hacer mejor mi trabajo'),
('Mi jefe distribuye las tareas de forma que me facilita el trabajo'),
('Mi jefe me comunica a tiempo la información relacionada con el trabajo'),
('La orientación que me da mi jefe me ayuda a hacer mejor el trabajo'),
('Mi jefe me ayuda a progresar en el trabajo'),
('Mi jefe me ayuda a sentirme bien en el trabajo'),
('Mi jefe ayuda a solucionar los problemas que se presentan en el trabajo'),
('Siento que puedo confiar en mi jefe'),
('Mi jefe me escucha cuando tengo problemas de trabajo'),
('Mi jefe me brinda su apoyo cuando lo necesito'),
('Me agrada el ambiente de mi grupo de trabajo'),
('En mi grupo de trabajo me tratan de forma respetuosa'),
('Siento que puedo confiar en mis compañeros de trabajo'),
('Me siento a gusto con mis compañeros de trabajo'),
('En mi grupo de trabajo algunas personas me maltratan'),
('Entre compañeros solucionamos los problemas de forma respetuosa'),
('Hay integración en mi grupo de trabajo'),
('Mi grupo de trabajo es muy unido'),
('Las personas en mi trabajo me hacen sentir parte del grupo'),
('Cuando tenemos que realizar trabajo de grupo los compañeros colaboran'),
('Es fácil poner de acuerdo al grupo para hacer el trabajo'),
('Mis compañeros de trabajo me ayudan cuando tengo dificultades'),
('En mi trabajo las personas nos apoyamos unos a otros'),
('Algunos compañeros de trabajo me escuchan cuando tengo problemas'),
('Me informan sobre lo que hago bien en mi trabajo'),
('Me informan sobre lo que debo mejorar en mi trabajo'),
('La información que recibo sobre mi rendimiento en el trabajo es clara'),
('La forma como evalúan mi trabajo en la empresa me ayuda a mejorar'),
('Me informan a tiempo sobre lo que debo mejorar en el trabajo'),
('En la empresa confían en mi trabajo'),
('En la empresa me pagan a tiempo mi salario'),
('El pago que recibo es el que me ofreció la empresa'),
('El pago que recibo es el que merezco por el trabajo que realizo'),
('En mi trabajo tengo posibilidades de progresar'),
('Las personas que hacen bien el trabajo pueden progresar en la empresa'),
('La empresa se preocupa por el bienestar de los trabajadores'),
('Mi trabajo en la empresa es estable'),
('El trabajo que hago me hace sentir bien'),
('Siento orgullo de trabajar en esta empresa'),
('Hablo bien de la empresa con otras personas'),
('Atiendo clientes o usuarios muy enojados'),
('Atiendo clientes o usuarios muy preocupados'),
('Atiendo clientes o usuarios muy tristes'),
('Mi trabajo me exige atender personas muy enfermas'),
('Mi trabajo me exige atender personas muy necesitadas de ayuda'),
('Atiendo clientes o usuarios que me maltratan'),
('Para hacer mi trabajo debo demostrar sentimientos distintos a los míos'),
('Mi trabajo me exige atender situaciones de violencia'),
('Mi trabajo me exige atender situaciones muy tristes o dolorosas'),
('Tengo colaboradores que comunican tarde los asuntos de trabajo'),
('Tengo colaboradores que tienen comportamientos irrespetuosos'),
('Tengo colaboradores que dificultan la organización del trabajo'),
('Tengo colaboradores que guardan silencio cuando les piden opiniones'),
('Tengo colaboradores que dificultan el logro de los resultados del trabajo'),
('Tengo colaboradores que expresan de forma irrespetuosa sus desacuerdos'),
('Tengo colaboradores que cooperan poco cuando se necesita'),
('Tengo colaboradores que me preocupan por su desempeño'),
('Tengo colaboradores que ignoran las sugerencias para mejorar su trabajo');


CREATE TABLE intralaboral_a_respuestas (
  id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
  id_formulario INT NOT NULL,  -- se refiere a la tabla 'form_datos_generales'
  id_pregunta INT NOT NULL,
  id_opcion_respuesta INT NOT NULL,
  FOREIGN KEY (id_formulario) REFERENCES form_datos_generales(id),
  FOREIGN KEY (id_pregunta) REFERENCES intralaboral_a_preguntas(id),
  FOREIGN KEY (id_opcion_respuesta) REFERENCES intralaboral_a_opciones_respuesta(id)
);

INSERT INTO intralaboral_a_respuestas (id_formulario, id_pregunta, id_opcion_respuesta) VALUES
    (1, 1, 3),
    (1, 2, 3),
    (1, 3, 3),
    (1, 4, 4),
    (1, 5, 4),
    (1, 6, 5),
    (1, 7, 1),
    (1, 8, 5),
    (1, 9, 4),
    (1, 10, 2),
    (1, 11, 5),
    (1, 12, 2),
    (1, 13, 3),
    (1, 14, 1),
    (1, 15, 2),
    (1, 16, 2),
    (1, 17, 2),
    (1, 18, 5),
    (1, 19, 3),
    (1, 20, 2),
    (1, 21, 4),
    (1, 22, 1),
    (1, 23, 5),
    (1, 24, 5),
    (1, 25, 2),
    (1, 26, 2),
    (1, 27, 2),
    (1, 28, 2),
    (1, 29, 2),
    (1, 30, 3),
    (1, 31, 1),
    (1, 32, 3),
    (1, 33, 3),
    (1, 34, 3),
    (1, 35, 4),
    (1, 36, 5),
    (1, 37, 2),
    (1, 38, 4),
    (1, 39, 3),
    (1, 40, 3),
    (1, 41, 5),
    (1, 42, 5),
    (1, 43, 4),
    (1, 44, 2),
    (1, 45, 2),
    (1, 46, 1),
    (1, 47, 5),
    (1, 48, 4),
    (1, 49, 5),
    (1, 50, 2),
    (1, 51, 1),
    (1, 52, 5),
    (1, 53, 5),
    (1, 54, 1),
    (1, 55, 1),
    (1, 56, 5),
    (1, 57, 2),
    (1, 58, 1),
    (1, 59, 1),
    (1, 60, 2),
    (1, 61, 4),
    (1, 62, 5),
    (1, 63, 4),
    (1, 64, 5),
    (1, 65, 2),
    (1, 66, 5),
    (1, 67, 3),
    (1, 68, 3),
    (1, 69, 2),
    (1, 70, 3),
    (1, 71, 4),
    (1, 72, 5),
    (1, 73, 2),
    (1, 74, 1),
    (1, 75, 2),
    (1, 76, 2),
    (1, 77, 5),
    (1, 78, 3),
    (1, 79, 1),
    (1, 80, 2),
    (1, 81, 1),
    (1, 82, 1),
    (1, 83, 4),
    (1, 84, 4),
    (1, 85, 3),
    (1, 86, 3),
    (1, 87, 1),
    (1, 88, 5),
    (1, 89, 5),
    (1, 90, 3),
    (1, 91, 3),
    (1, 92, 5),
    (1, 93, 4),
    (1, 94, 4),
    (1, 95, 4),
    (1, 96, 5),
    (1, 97, 4),
    (1, 98, 4),
    (1, 99, 3),
    (1, 100, 2),
    (1, 101, 2),
    (1, 102, 3),
    (1, 103, 5),
    (1, 104, 5),
    (1, 105, 1),
    (1, 106, 5),
    (1, 107, 5),
    (1, 108, 1),
    (1, 109, 3),
    (1, 110, 4),
    (1, 111, 1),
    (1, 112, 4),
    (1, 113, 5),
    (1, 114, 5),
    (1, 115, 5),
    (1, 116, 2),
    (1, 117, 3),
    (1, 118, 5),
    (1, 119, 2),
    (1, 120, 3),
    (1, 121, 1),
    (1, 122, 4),
    (1, 123, 1);

CREATE OR REPLACE VIEW vista_intralaboral_a_resumen AS
SELECT 
  fdg.id AS encuesta_id,
  fdg.fecha_aplicacion,
  fdg.identificacion_respondiente AS id_empleado,
  ip.descripcion AS pregunta,
  ior.etiqueta AS respuesta,
  ior.valor AS valor_respuesta
FROM 
  intralaboral_a_respuestas ir
JOIN 
  form_datos_generales fdg ON ir.id_formulario = fdg.id
JOIN 
  intralaboral_a_preguntas ip ON ir.id_pregunta = ip.id
JOIN 
  intralaboral_a_opciones_respuesta ior ON ir.id_opcion_respuesta = ior.id
ORDER BY 
  fdg.id, ip.id;


CREATE VIEW vista_intralaboral_a_estadistica AS
SELECT 
  ilap.id AS id_pregunta,
  ilap.descripcion AS pregunta,
  ilaor.id AS id_opcion,
  ilaor.etiqueta AS opcion_respuesta,
  COUNT(ilar.id_opcion_respuesta) AS frecuencia,
  ROUND(
    COUNT(ilar.id_opcion_respuesta) * 100.0 / 
    (SELECT COUNT(*) 
     FROM intralaboral_a_respuestas 
     WHERE id_pregunta = ilap.id), 
    2
  ) AS porcentaje
FROM 
  intralaboral_a_preguntas ilap
JOIN 
  intralaboral_a_opciones_respuesta ilaor
LEFT JOIN 
  intralaboral_a_respuestas ilar 
    ON ilap.id = ilar.id_pregunta 
   AND ilaor.id = ilar.id_opcion_respuesta
GROUP BY 
  ilap.id, ilap.descripcion, ilaor.id, ilaor.etiqueta
ORDER BY 
  ilap.id, ilaor.id;
